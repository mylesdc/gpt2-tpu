To accurately identify orthologous sequences in the six mammalian species, we used syntenic whole-genome alignments produced by the MULTIZ program [1] on the following assemblies available through the UCSC genome browser [2]: human (hg18), chimpanzee (panTro2), macaque (rheMac2), mouse (mm8), rat (rn4), and dog (canFam2). The human genome was used as a reference genome. We used the pairwise syntenic nets [3] with respect to human genome as an input to MULTIZ pipeline to reduce the likelihood of paralogous alignments. We compensated for low sequence quality in some regions by masking the bases in chimpanzee, macaque, rat, and dog with sequence quality lower than 20.
To accurately identify orthologous sequences in the six mammalian species, we used syntenic whole-genome alignments produced by the MULTIZ program [1] on the following assemblies available through the UCSC genome browser [2] : human (hg18), chimpanzee (panTro2), macaque (rheMac2), mouse (mm8), rat (rn4), and dog (canFam2). The human genome was used as a reference genome. We used the pairwise syntenic nets [3] with respect to human genome as an input to MULTIZ pipeline to reduce the likelihood of paralogous alignments. We compensated for low sequence quality in some regions by masking the bases in chimpanzee, macaque, rat, and dog with sequence quality lower than 20.
To identify genes within these alignments, we used the union of all human annotated genes in RefSeq [4] , UCSC Known Genes [5] , and VEGA [6] , downloaded from the UCSC genome browser on February 19, 2007 . We discarded transcripts without annotated coding regions (CDSs), CDSs shorter than 100 bp, as well as CDSs with length other than multiple of three. Clustering of the remaining 88,879 transcripts (some of them may be duplicates from different annotation databases) resulted in an initial set of 21,115 gene clusters in the human genome.
We then used our syntenic alignments to map these genes to other five mammalian species. For the purpose of the positive selection analysis, we are interested in a high-confidence set of orthologous alignments. To ensure the quality of our data set, we have subjected the resulting alignments to a series of filters designed to minimize impact of annotation errors, sequence quality, and changes in gene structure on subsequent analysis. In particular, we require that: (1) a transcript maps to the non-human genome via a single chain of sequence alignments that includes at least 80% of CDS (as determined by building process of UCSC syntenic maps), (2) no more than 10% of CDS falls into known sequencing gaps or low quality sequence in the non-human genome, (3) there are no frame-shifts in the non-human CDS, unless they are compensated for within 15 bases, (4) and there are no in-frame stop codons in the non-human CDS, and all splice sites are conserved.
In an earlier study [7] , we have found that start sites and stop codons are often not conserved between species. Therefore, we also consider incomplete transcripts, where we remove ∼10% of coding sequence from both ends of the complete transcript, and subject them to the same series of filters.
For each gene cluster we have selected the transcript (complete or incomplete) that has been successfully mapped to the largest number of species, using CDS length as a secondary criteria. This procedure resulted in 17,500 genes that were successfully mapped to at least two additional species besides human. For technical reasons, we have removed 11 additional transcripts, obtaining orthologous multiple alignments for 17,489 genes, with average of ∼4 non-human orthologs per gene. The number of genes in this data set for each species is shown in Table 1 .
For recently duplicated genes it is impossible to establish 1:1 orthologous relationships of human gene and its non-human lineage ortholog. Moreover, these genes often occur in tandem clusters, where it is hard to distinguish orthologous from paralogous relationships. We have developed a pairwise test for these recent duplications (i.e., duplication occurring after split from the non-human species lineage), and to avoid potential false positives, we have removed from our set orthologs that have such a recent non-pseudogenized duplication in either human lineage or in the non-human lineage. (Note that we do not necessarily remove the affected gene completely from the analysis. For example, if there is a recent duplication specific to the dog lineage, we can still use orthologs of the same gene in chimp, macaque, mouse and rat.)
To detect recent duplications, we used a collection of gene predictions from UCSC genome browser using the following sources: RefSeq (human, chimpanzee, mouse, rat, dog), transmapped RefSeq (macaque), N-scan predictions (all species), ENSEMBL predictions (human, mouse, rat), and UCSC known genes (human, mouse, rat).
For each of the 17,500 genes that previously passed our filters, and in each species where the gene was successfully mapped, we used nucleotide blast to locate the closest non-overlapping gene prediction with alignment covering at least 80% of the CDS. If a gene in the human genome has a closer match within the human than to its counterpart in the non-human species mapped through syntenic alignment, we detected a duplication on human lineage that is recent with respect to that non-human species. Similarly, if the counterpart of the human gene (mapped through syntenic alignment) in non-human genome has closer match among gene predictions within the same genome than to its corresponding human gene, we detected a recent duplication on that other species lineage that is recent with respect to that species. When comparing distances, we apply a simple correction based on Jukes-Cantor distance to compensate for faster evolution on rodent lineage.
2 Likelihood ratio tests for positively selected genes 2.1 Effect of pooling genes by G+C class As noted in the text, the genes were partitioned into 8 equally sized groups by third-codon-position G+C content. The branch length proportions and the transition/transversion rate ratio κ were estimated by pooling the data within each class, and only an overall scale factor for branch lengths (µ) and the selection parameters (ω 0 , ω 1 , p 0 , p 1 ) were estimated per gene. This strategy was intended to improve computational efficiency, by substantially decreasing the number of parameters to be estimated per gene. It also had the potential to increase the power of the test, by reducing the number of degrees of freedom in the LRT. However, if the assumptions of equal branch-length proportions and equal κ values per G+C class are not well-supported by the data, it could potentially lead to inflated false-positive rates and/or reduced power. Here, we investigate by simulation whether or not this parameterization influences either the power or the false-positive rates of the LRTs.
We selected 250 genes randomly from each of the 8 G+C classes, for a total of 2,000 genes representing the full set of 17,489. For each of these 2,000 genes, we estimated κ and a complete set of branch lengths using model 1a [8] . We stored these sets of parameter estimates, along with the length of each alignment, in a list L C for each G+C class C. We then sampled parameter sets (with replacement) 2,000 times from each list L C and used them to generate six-species synthetic alignments with evolver [9] , assuming a constant ω among lineages and sites (model M0). This process was repeated for several different values of ω, so that no assumption about the distribution of this parameter was required. Thus, for each G+C class and each ω we obtained 2,000 simulated data sets, with lengths, branch-length proportions, and κ values reflecting those of the corresponding G+C class in the original data set.
The all-branch LRT was then applied to these simulated alignments using two different strategies (separately for each value of ω): (i) by estimating κ and the branch-length proportions once per G+C class, then estimating only the remaining parameters per gene, as for the main analysis; and (ii) by estimating all parameters per gene. Each synthetic gene was then predicted as a PSG if its (empirical) P -value was less than a designated threshold, and a non-PSG otherwise. The fraction of genes predicted to be PSGs (the sensitivity or power for ω > 1 and the false positive rate for ω ≤ 1) was then plotted as a function of ω, separately for strategies (i) and (ii) (Fig. S8) . These experiments indicated that pooling by G+C class has almost no effect on the sensitivity or specificity of the test. Similar results are seen if sensitivity and specificity are examined together in a receiver-operating characteristic (ROC) curve (Fig. S9) . Thus, G+C pooling seems to have essentially no cost in terms of false positive rates or power, but it has the benefit of a substantial savings in computation, by reducing the number of parameters to be estimated per gene (by nine, in this case).
3 Calculation of P -values using chi-square and empirical distributions For the LRT for positive selection on all branches of the phylogeny, we used empirical P -values derived from simulations. Ideally, a similar approach would also be used for the branch and clade LRTs. However, the simulation of the empirical distributions is computationally expensive, and to save thousands of processorhours of simulation time, we have instead assumed a 50:50 mixture of a χ 2 df =1 distribution and a point mass at zero for these LRTs, as suggested by Zhang et al. [10] .
Here, we examine this assumption by comparing empirical and chi-square-derived P -values for a specific branch (the one leading to macaque), and a specific clade (the primates). As with the all-branch test (see Methods), 10,000 alignments were simulated under model 1a, log-likelihood ratios were calculated for the appropriate lineage or clade-specific models, and (nominal) empirical P -values were derived from these models. Figure S10 shows that the χ 2 -based P -values are generally conservative for both LRTs. This is true even when a 50:50 mixture of a χ 2 df =1 distribution and point mass at zero is used; χ 2 df =1 and χ 2 df =2 distributions are more conservative. Thus, the use of the approximation will not produce an inflated false positive rate, but it could result in some spurious false negatives. Nevertheless, we find that the approximation has little effect on the set of PSGs identified for the analysis. If the empirical P -values are used in place of the χ 2 -based P -values, the number of identified PSGs changes only by four (primate clade) or two (macaque branch).
4 Analysis of over-represented functional categories 4.1 Possible bias from alignment depth A possible concern with the enrichment analysis is that it might reflect differences between categories in the alignment depth per gene. For example, if genes in the "sensory perception of smell" category are significantly more likely than other genes to have full six-species alignments (as opposed to alignments of three, four, or five species, due to recent duplication, low sequence quality, etc.), then an enrichment for PSGs in this category might simply reflect an increase in power for PSG detection.
To examine this possibility, we divided all alignments into high-depth (five or six species) and low-depth (three or four species) classes, and looked for functional enrichments within each class. We found that there are significant differences in the functional categories of high-and low-depth genes, but these differences cannot explain the PSG enrichments. In particular, the categories that are over-represented among highdepth genes generally relate to housekeeping and development functions, and are essentially disjoint with the PSG-enriched categories. Many of the PSG-enriched categories relating to sensory perception are actually quite strongly enriched in low-depth genes, for which the power to detect positive selection will be reduced-a trend that runs in the opposite direction of what would be required for the PSG enrichments to be an artifact of differences in power. Accordingly, if the analysis of functional enrichments for PSGs is redone with just the high-depth genes, the immunity and defense categories still are found to be highly enriched. The sensory perception genes are no longer significantly enriched, but this is probably because there are many fewer of them among the high-depth genes. In summary, we find no evidence that the observed enrichments for PSGs are related to differences in detection power due to alignment depth. Recent duplication likely contributes to the enrichments for sensory perception among both PSGs and low-depth genes.
We also examined the possibility that the observed differences in the functional categories identified by the primate-and rodent-clade LRTs might be artifacts of differences in alignment depth. We found that, even when only high-depth genes are considered, the MWU test for the primate-clade LRT primarily identifies categories related to sensory perception, while the MWU test for the rodent-clade LRT primarily identifies categories related to immunity and defense. The results are similar if only genes that include both rodent species are considered, confirming that the enrichment for sensory perception categories in primates is not simply due to an absence of rodent data for genes in these categories (for example, because of recent duplications).
A similar possibility is that differences in gene length (i.e., total coding sequence length) could produce spurious functional enrichments, because the power to detect positive selection depends on length (see Fig. 6 ) and the genes assigned to different GO categories sometimes have quite different length distributions. We examined this possibility in two ways. First, if gene length were driving the detection of PSGs, then a pronounced difference in the length distributions of PSGs and non-PSGs would be expected. In fact, these distributions are highly similar (Fig. S11 ) and the null hypothesis that both sets of lengths are drawn from the same distribution cannot be rejected (P = 0.33, one-sided MWU). This suggests that it is unlikely that length is a dominant factor in the analysis. Second, we examined the length distributions of the enriched categories of genes (Table 2) , to see whether gene length might be an important factor for particular categories of interest. By a MWU test comparing the length distribution within each category with that of other genes, most categories enriched for PSGs did not contain significantly longer genes than other categories. Indeed, seven PSG-enriched categories-including 'cytokine activity,' 'olfactory receptor activity,' and 'response to bacterium'-showed a significant shift toward shorter genes in their length distributions. However, there were two categories of genes-'integral to membrane' and 'transmembrane receptor activity' (marked by asterisks in Table 2 )-that did show significant shifts toward longer genes, and it is possible that the enrichments for these GO categories are influenced by increased detection power. These categories have not been discussed at length in the paper, and this finding of a possible bias does not alter the main conclusions of our functional analysis.
Gains and losses of positive selection would ideally be modeled in continuous time, and would be allowed to occur at any point along branches (see, e.g., [11] ). However, making inferences about the quantities of interest here (e.g., numbers of genes under selection on particular branches, the probability that each gene has an episodic history) would require a complex model and would be computationally prohibitive at the scale of our analysis. In addition, it is likely that our six-species data set would provide only weak information about mid-branch gains and losses. Instead, our model attempts to exploit the discrete-branch nature of the Yang-Nielsen branch-site models, by defining a simple switching process that induces a probability distribution over the finite set of selection histories considered by those models. As noted in the text, this approach allows the likelihood computation and inference of selection histories to be decoupled (if the maximum likelihood values for codon-model parameters are assumed), making it possible to apply the method efficiently to large sets of genes.
To explain every possible branch-wise selection history by a parsimonious set of switches, there must be switch points for both "early" and "late" switches on internal branches of the tree. A single early switch point is sufficient for external branches. To see why two switches are needed, suppose only early switches are allowed (i.e., a switch is possible at the ancestral end of each branch). Such a model will allow any selection history to be determined by a set of switches (each branch is simply switched "on" or "off," as necessary, to be consistent with a given history), but the set of switches will not be parsimonious. The problem arises when the branch ancestral to an internal node has one selective mode and the two branches that descend from the node have the other selective mode. In this case, it is far more plausible biologically that a single change in selection occurred soon before the divergence of the descendant species, than that two independent (and convergent) events occurred in the descendant species, as will be required by the early-switch model. Redefining the model so that events occur late rather than early does not solve the problem, because this requires that both descendant branches always have the same mode, and therefore cannot capture all histories. Allowing a single switch at the midpoint of each branch also is problematic, because it leads to branches that are only partly under selection, which is not compatible with the Yang-Nielsen models. The introduction of early and late switch points allows all selection histories to be explained parsimoniously, in a way that is fully compatible with a discrete-branch selection model.
It is worth noting that, unlike the early-switch model, the double-switch model does not allow a set of switches to be uniquely determined by a selection history. For example, a single switch on an ancestral branch could be replaced by two switches on descendant branches. Even more unlikely, three switches could be introduced in place of zero switches, where all three branches adjoining an internal node have the same selective mode. To address this problem, we invoke the parsimony principle, and select the history with the fewest switches (which is unique; see below). We justify this decision by noting that all nonparsimonious scenarios require at least one additional switch within the set of switch points surrounding a single internal node. Thus, these scenarios represent cases of multiple rare events occuring during a short time period, and it is reasonable to assume that their probabilities are quite small.
Finally, the issue of the root of the phylogeny deserves further comment. As noted in the text, the selection histories are defined with respect to an unrooted tree, and their likelihoods are evaluated accordingly. However, the switching model actually requires a root, because branches must be oriented in order to define gains and losses. Because the tree is believed to be rooted on the branch to dog (e.g., [12] ), and the primaterodent and (primate,rodent)-dog divergences are believed to have occurred relatively near one another in evolutionary time (making the branch between the corresponding nodes in the phylogeny fairly short), we address this problem by treating the primate-rodent most recent common ancestor as the root of the tree, and all three adjoining branches as descendants.
Here we describe the algorithm for defining a unique, parsimonious set of switches corresponding to a particular selection history Z. As in the text, let Z b ∈ {0, 1} represent the selective mode of branch b ∈ {1, . . . , B}. In addition, let the switch point for internal node n ∈ N and adjoining branch b ∈ B n be denoted P nb , and let V nb ∈ {0, 1} and W nb ∈ {0, 1} indicate the selective states before and after point P nb , respectively. Let (U nb , T nb ) be a permutation of (V nb , W nb ) such that U nb represents the internal state (i.e., near node n) and T nb represents the external state (i.e., away from n). That is,
Because there can be no switches between switchpoints, it must be true that U nb = U nb for all b and b adjacent to the same node n. Similarly, external states are determined by the states of branches in the selection history; that is, T nb = Z b for all n and b. Thus, the U nb variables, together with the Z b variables, completely determine the switches. Because all U nb must be equal for a given n, only one value is needed for each n, call it U n . It is not hard to see that setting each U n to the majority value of the flanking Z b variables must result in a parsimonious set of switches; that is U n = I( b∈Bn Z b ≥ 2). Setting U n this way requires at most one switch per internal node, while setting it otherwise would require at least two. The algorithm, then, is simply to set each U n to the majority value of the adjoining Z b variables, and to set each T nb equal to the corresponding Z b . The (V nb , W nb ) variables can be determined by permuting the corresponding (U nb , T nb ) variables.
As described in the text, the complete data likelihood under the hierarchical Bayes model is,
with
where N is the number of genes, M is the number of histories, X = (X 1 , . . . , X N ) is the set of alignments, Z = (Z 1 , . . . , Z N ) is the set of histories, N is the set of internal nodes, B n is the set of branches adjoining internal node n, U i0 is the selective state at the root for gene i, (V inb , W inb ) are the selective states before and after switch point P nb for gene i, θ = {θ nbe : n ∈ N , b ∈ B n , e ∈ {G, L}} ∪ {θ 0 } is the set of parameters, L ij is the precomputed maximum log likelihood for gene i under history j, and (α, β) defines the prior for all parameters. Combining these equations yields:
The Gibbs sampler alternates between sampling each Z i conditional on all other parameters and sampling each component of θ conditional on all other parameters. The Z i s are conditionally independent of each other, and each Z i is conditionally independent of (X 1 , . . . , X i−1 , X i+1 , X N ) given X i . Hence, the conditional distribution for Z i is given by:
where P (Z i |θ) is defined as above, the P (θ) term cancels, and, to prevent underflow, the numerator and denominator are divided by exp(L i,max ) with L i,max = max j L i,j . Thus, each Z i can be sampled from an Mcomponent multinomial distribution, which can be computed by calculating exp(L i,j − L i,max )P (Z i = j|θ) for all j and then normalizing. Similarly, the components of θ are conditionally independent of one another and of X given Z. After cancellation of terms involving X and other elements of θ, the distribution for an individual component, say θ nbG is given by:
Thus, θ nbG can be sampled from a Beta distribution, in the ordinary way for a Bernoulli random variable with a conjugate Beta prior. We sample Beta random variables by sampling two Gamma random variables and taking their ratio. The Gamma variables are sampled using Best's rejection algorithm. Similarly, the distributions for θ nbL and θ 0 are given by:
The Gibbs sampling algorithm, then, initializes θ to an appropriate value, samples each Z i from a multinomial distribution, computes the counts A nb , B nb , C nb , D nb , and U 0 from the sampled Z, samples θ 0 and each θ nbe from a Beta distribution, samples each Z i again, and so on. Convergence of the algorithm was assessed by plotting the sampled values and log P (X, Z, θ) versus the iterations of the sampler. It converges very rapidly. The sampler was run for 10,000 iterations with a generous burn-in period of 100 iteration. Multiple runs with various initializations produced essentially identical results.
In addition to the model discussed above, we examined two simpler models. The first alternative model assumed a single switching parameter θ that was shared across all branches and represented both the rate of loss and the rate of gain. The second model allowed for separate rates of gain and loss, but assumed these rates were the same on all branches. The three candidate models are therefore nested, with the twoparameter model being a special case of the full model, and the one-parameter model being a special case of the two-parameter model.
All models produced qualitatively similar results for the number of genes under selection per branch or clade (Table S4) . However, the inferred rates under the full model differed significantly both for gains and losses and across branches, implying that separate parameters were warranted, and the use of the full model substantially altered the estimated numbers of genes under selection on certain branches (Table S4) . Under the one-parameter model, the gain/loss rate θ was estimated at 0.13 (95% CI 0.12-0.14), while under the two parameter model, the loss and gain rates were both estimated at 0.13 (0.12-0.15). The estimated number of switches per gene was nearly identical under all models (1.6).
6 Gene expression 6 
Two statistics were used to measure tissue bias. The first, denoted τ , is defined as [13] :
where v t is the estimated expression intensity in tissue t, v max = max t v t , and N is the number of tissues. τ represents the average difference in normalized expression intensity from that of the tissue of maximal expression. The second statistic, here denoted γ t , is defined for each tissue t as [14] :
where v is the 11-dimensional expression vector, |v| is its Euclidean length, v t is the component associated with tissue t, and θ is the angle between v and the coordinate axis associated with tissue t. Note that t γ t = 1 for each gene. As a general measure of tissue bias for each gene, we use γ = max t γ t . Both τ and γ range between 0 and 1, with larger values indicating greater tissue bias.
In defining genes as tissue specific for tissue t we required γ t > 0.25 and γ t < 0.125 for all t = t. Thus, the expression intensity for tissue t must be at least half of the total intensity, measured in Euclidean space (v t /|v| > 0.5), with γ t < 0.125 ensuring that all other tissue have substantially reduced intensities.
We also examined the expression patterns of genes identified by the LRTs for positive selection in the primate clade or the rodent clade. The primate PSGs showed reduced expression levels in most tissues, with statistically significant reductions in the cerebellum, kidney, spleen, and testes. Perhaps not surprisingly, the rodent PSGs and non-PSGs did not generally show significantly different (human) expression levels, except in liver and cerebellum, where expression in PSGs was slightly reduced. A modest increase in tissue bias was seen for both primate and rodent PSGs. Only a few tissue-specific genes were identified by the clade tests, so it was not possible to compare the relationships between tissue-specific expression and positive selection in primates and in rodents. However, we did find significant enrichments for primate PSGs among spleen-specific genes, and for rodent PSGs among testes-specific genes.
A possible concern is that the finding of decreased expression levels and increased tissue bias among PSGs is a spurious result stemming from a dependency of detection power and/or false positive (FP) rates on degree of constraint at sites experiencing neutral evolution or negative selection ("background" sites). Specifically, suppose FP rates for PSG detection are higher among non-PSGs with ω ≈ 1 than for those with ω 1. In addition, suppose true PSGs are more likely to be detected if their background sites have higher average ω values, resulting in higher average ω for the genes as a whole. Finally, suppose there is a strong negative correlation between ω and expression level, and a strong positive correlation between ω and tissue bias, as has been widely reported (e.g., [15] )-but suppose that this relationship can be explained completely in terms of background sites, and reflects no dependency on positive selection. In such a case, the argument goes, FPs among the PSGs would be enriched for decreased expression and increased tissue bias, and false negatives (FNs) among the non-PSGs would be enriched for increased expression and decreased tissue bias, leading to an artifactual difference in expression levels and patterns between the two classes of genes.
It is difficult to correct the analysis for background ω in a direct way, because the power to identify particular sites under positive selection is weak, and estimates of foreground and background ω are confounded with each other and with the detection of positive selection itself. Instead, we used a simple, conservative method to eliminate FPs showing low expression (or high tissue bias; these attributes were handled separately) and FNs showing high expression (or low tissue bias). We divided the genes into classes of "low" and "high" expression level (tissue bias), and then defined a new set of PSGs by using a very stringent P -value threshold for low-expression (high-bias) genes (FDR < 0.01) and a considerably less stringent threshold for high-expression (low-bias) genes (FDR < 0.1). Thus, the low-expression (high-bias) PSGs most likely to be false positives were transferred to the non-PSG set, and the high-expression (low-bias) non-PSGs most likely to be false negatives were transferred to the PSG set. This procedure is conservative in that it necessarily diminishes the difference in expression levels and patterns between the two sets. The analysis was based on the results of the all-branch test, as was the main analysis of expression levels and patterns. The genes were partitioned into classes of "low" and "high" expression based on their median (across the 11 tissues) RMA-based expression levels, with the median of this value across all genes serving as the cutoff (i.e., the "low" and "high" classes were equal in size). Similar results were obtained using the maximum expression level across tissues for each gene, and using the expression level measured from a tissue mixture. The genes were partitioned into classes of "low" and "high" tissue-bias in a similar way based on the τ statistic.
Even after this conservative correction, significantly reduced expression levels were observed in PSGs in nearly all tissues, although in many cases the reduction is considerably less dramatic than it was before the correction was applied (Fig. S12 ; c.f. Fig. S7) . Similarly, tissue bias remains significantly increased in PSGs relative to non-PSGs, with a less pronounced difference following the correction (Fig. S13 ; c.f. Fig. 5D ). We conclude that an association of FPs and FNs with expression levels and patterns may partially contribute to the observed difference between PSGs and non-PSGs, but that it is unlikely to explain these differences completely.
Another concern about the expression analysis is that reduced expression levels among PSGs may simply be a consequence of increased tissue bias. That is, if genes that show a bias for expression in particular tissues have reduced average expression, and if the choice of tissue is randomly distributed across genes, then an overall reduction in the average expression level for each tissue would result. The question remains, then, whether PSGs show reduced expression levels not only on average, but in the tissues in which their expression is favored. To address this question, we found the maximum expression level across the 11 tissues for each gene, and then compared the distributions of these values for PSGs and non-PSGs. By this comparison, PSGs still show significantly lower expression levels than non-PSGs (P = 3.6 × 10 −6 ; data not shown), although the difference is considerably less pronounced than for certain individual tissues such as cerebellum, muscle, and thyroid (Fig. S7) . Thus, differences in tissue bias may partly explain differences in expression level, but the explanation does not appear to be complete. This question cannot be fully resolved without expression data from a larger number of tissues.
In addition to the phylogenetic interpretation ω, we use a population genetic interpretation of ω which was first introduces by Halpern and Bruno [16] and further developed by Nielsen and Yang [17] and Thorne et al. [18] . The probability that a new mutation eventually becomes fixed is
if we assume that the selection coefficient s is small and N is large and equal to the effective population size [19] . In the neutral case (s ≈ 0) this is simply the the initial frequency of the mutation 1 2N . The fixation rate ν of new mutations is the product of the mutation rate µ per site, the chromosomal population size in mammalian species 2N and the probability of fixation
The rate of substitution of neutral mutations is
We can now compare the relative rates of neutral mutations (Eq. 12) and selected mutations (Eq. 11). If we assume that all non-synonymous mutations at the same amino acid site have the same selection coefficient and that all synonymous mutations are neutral we have
where γ = 2N s. We have calculated ω = P dN P dS , where (dN, dS) was estimated for each of the 10,980 genes humanchimp-macaque trios using PAML [9] . To generate confidence intervals for dN/dS, we used 10,000 nonparametric bootstrap samples generated by sampling with replacement (dN , dS) pairs estimated from the 10,980 genes. Finally numerical estimates of γ = 2N s where obtained by using the "uniroot" function in R. a Branch or clade of interest. Hominid is branch leading to human and chimpanzee, primate is branch leading to hominid and macaque, and rodent is branch leading to mouse and rat (see Fig. 4 ).
b Whether number represents sum over all histories in which branch or clade of interest is under selection or the single history in which only that branch (or only the branches in that clade) is under selection.
c One-parameter model (equal gain and loss rates shared across all branches Branches are those leading to human (hum), chimpanzee (chi), macaque (mac), mouse (mou), rat (rat), dog (dog), the hominid ancestor (hom), the primate ancestor (pri), and the rodent ancestor (rod). Gain parameters are indicated by ".G" and shown in green, and loss parameters are indicated by ".L" and shown in red. Two sets of parameters are shown for ancestral branches, corresponding to (1) early and (2) late events. The posterior densities for the parameter defining the probability of selection at the root of the tree (θ 0 ) is also indicated ("root"), as is the prior density assumed for all parameters (Beta(1, 9) ). As in a standard boxplot, the box boundaries indicate the lower and upper quartiles (0.25 and 0.75 quantiles) and the horizontal bar indicates the median, but here the whiskers indicate 95% credible intervals (i.e., 0.025 and 0.975 quantiles) rather than the extreme values of all samples. The number of samples was 9900. Figure S3 : Power of the LRT for selection on any branch of the phylogeny as a function of the nonsynonymous-synonymous rate ratio ω. Power is defined as the fraction of tests resulting in (A) nominal P < 0.05 or (B) nominal P less than the threshold required to ensure FDR < 0.05 for the real data set. Simulations were conducted as described in Fig. 6 . 
where G x is the set of all GO categories of gene x. Gene pairs were binned according to relative entropy and an average GO similarity was calculated for each bin. Only pairs assigned to the same major category (i.e., biological process, molecular function and cellular component) were compared. Gene pairs with low relative entropy tend on average to have higher GO similarity scores, suggesting that genes with similar selection histories carry similar functions and that some degree of co-evolution is frequent. Figure S9 : Receiver-operating characteristic (ROC) curve showing the trade-off between sensitivity and specificity for the all-branch LRT as the P -value threshold is varied. Sensitivity is defined as the fraction of synthetic data sets with ω = 1.5 predicted to be under positive selection, and 1-specificity is the fraction of data sets with ω = 0.5 predicted to be under positive seletion. Separate curves are shown for the cases of G+C pooling and full estimation of all parameters per gene. thyroid p = 6.3x10 -3 p = 4.6x10 -9 p = 3.0x10 -7 p = 1.4x10 -1 p = 3.3x10 -2 p = 2.4x10 -3 p = 2.5x10 -9 p = 1.6x10 -3 p = 1.0x10 -4 p = 3.2x10 -7 p = 6.6x10 -20 Figure S12 : Distributions of expression levels in PSGs (red) and non-PSGs (blue), where PSGs are conservatively defined by an FDR threshold of 0.01 for genes with low expression and an FDR threshold of 0.10 for genes with high expression (see Text S1). Figure S13 : Distribution of degree of tissue bias in expression (τ ) in PSGs (red) and non-PSGs (blue), where PSGs are conservatively defined by an FDR threshold of 0.01 for genes with high tissue bias and an FDR threshold of 0.10 for genes with low tissue bias (see Text S1). The rightward shift of the PSG distribution remains significant (P = 1.8 × 10 −4 , one-sided MWU test).