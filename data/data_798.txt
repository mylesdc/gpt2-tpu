Background: Planning public health responses against pandemic influenza relies on predictive models by which the impact of different intervention strategies can be evaluated. Research has to date rather focused on producing predictions for certain localities or under specific conditions, than on designing a publicly available planning tool which can be applied by public health administrations. Here, we provide such a tool which is reproducible by an explicitly formulated structure and designed to operate with an optimal combination of the competing requirements of precision, realism and generality.
Preparedness against pandemic influenza has become a high priority public health issue and many countries that have pandemic preparedness plans [1] . For the design of such plans, mathematical models and computer simulations play an essential role because they allow to predict and compare the effects of different intervention strategies [2] . The outstanding significance of the tools for purposes of intervention optimization is limited by the fact that they cannot maximize realism, generality and precision at the same time [3] . Public health planners, on the other hand, wish to have an optimal combination of these properties, because they need to formulate intervention strategies which can be generalized into recommendations, but are sufficiently realistic and precise to satisfy public health requirements.
Published influenza models which came into application, are represented by two extremes: generalized but oversimplified models without dynamic structure which are publicly available (e.g. [4] ), and complex computer simulations which are specifically adjusted to real conditions and/or are not publicly available (e.g. [5, 6] ). The complexity of the latter simulations, however, is not necessary for a reliable description of infection dynamics in large populations [7] . A minimum requirement for a pandemic influenza planning tool is a dynamic modelling structure which allows investigation of time-dependent variables like incidence, height of the epidemic peak, antiviral availability etc. The tool should, on the other hand, be adjustable to local conditions to adequately support the pandemic preparedness plans of different countries which involve considerably different assumptions (Table 1) .
Here we describe a publicly available influenza pandemic preparedness planning tool [8] which is designed to meet the requirements in preparedness planning. It is based on an explicitly formulated dynamic system which allows addressing time-dependent factors. It is sufficiently flexible to evaluate the impact of most candidate interventions and to consider local conditions like demographic and economic factors, contact patterns or constraints within the public health system. In subsequent papers we will also provide examples and applications of this model for various interventions, like antiviral treatment and social distancing measures.
The model is based on a system of 1,081 differential equations which extend the classic SEIR model. Demographic parameters reflect the situation in Germany in 2005, but can be adjusted to other countries. Epidemiologic and clinic values were taken from the literature (see Tables 1,  2 , 3, 4, 5, 6 and the sources quoted there). Pre-set values can be varied by sliders and input fields to make different assumptions on the transmissibility and clinical severity of a new pandemic strain, to change the costs connected to medical treatment or work loss, or to simply apply the simulation to different demographic settings. Model properties can be summarized as follows. The mathematical formulation of this model is presented in detail in the online supporting material. The corresponding source code, programmed in Java, and further information can be downloaded from [8] .
According to the German National Pandemic Preparedness Plan [9] , the total population is divided in age classes, each of which is subdivided into individuals of low and high risk ( Table 2) . Transmission between these age classes is based on a contact matrix (Table 3) which is scaled such that the model with standard parameter values yields a given basic reproduction number R0. Values for the R0 associated with an influenza strain with pandemic potential are suggested to lie between 2 and 3 [10] . This value is higher than the effective reproduction number which has been estimated to be slightly lower than 2 [11, 12] . As a standard parameter, we use R0 = 2.5 which means that cases infect on average 2.5 individuals if everybody is susceptible and if no interventions are performed.
Susceptible individuals who become infected, incubate the infection, then become fully contagious and finally develop protective immunity (Table 4) . A fraction of cases remains asymptomatic; others become moderately sick or clinically ill (i.e. they need medical help). Depending on the combination of age and risk group, a fraction of the clinically ill cases needs to be hospitalized, and an agedependent fraction of hospitalized cases may die from the disease ( Table 5 ). This partitioning of the cases into four categories allows combining the realistic description of the transmission dynamics with an easy calculation of the resources consumed during an outbreak. The degree and duration of contagiousness of a patient depend on the course of the disease; the latter furthermore depends on the age of the patient (Table 5) . Passing through the incubation and contagious period is modelled in several stages which allows for realistic distributions of the sojourn times ( Table 4 ). The last two stages of the incubation period are used as early infectious period during which the patient can already spread the disease. Infectiousness is highest after onset of symptoms and thereafter declines geometrically (Table 6 ). Clinically ill patients seek medical help on average one day after onset of symptoms. Very sick patients are advised to withdraw to their home until their disease is over, whereas extremely sick patients need to be hospitalized and may die from the disease (Table 4) . After the end of their contagious period, clinically ill patients go through a convalescent period before they can resume their ordinary life and go back to work (Table 4) .
We provide some examples of model output of InfluSim [8] , version 2.0, by means of four sensitivity analyses; further investigations will be presented elsewhere. Figure 1 shows the graphical user interface of the software which is divided into input and output windows. The user may set new values in the input fields or move sliders to almost simultaneously obtain new results for the course of an epidemic in a given population. Figures 2A and 2B show pandemic waves which result from varying the basic reproduction number from 1.5 to 4.0. Using the standard parameter values as given in Tables 2, 3 , 4, 5, 6 and omitting all interventions in a town of 100,000 inhabitants results in a pandemic wave which lasts for about ten weeks (Figure 2A , with R 0 = 2.5). The peak of the pandemic wave is reached after six to seven weeks, with a daily incidence of up to 2,340 influenza patients seeking medical help, with up to 280 hospital beds occupied by influenza cases and with up to 14,000 out of 60,000 working adults unable to go to work because of illness or convalescence. These results depend on the assumptions concerning the yet unknown contagiousness and pathogenicity of the virus. Figures 2C and 2D show how the shape of the curves depends on the course of contagiousness: the pandemic wave proceeds relative slowly if the contagiousness does not change during the infectious period (x 50 = 50%), but proceeds quickly if the contagiousness is highest after onset of symptoms and decreases thereafter (x 50 > 50%).
The influenza pandemic preparedness planning tool InfluSim stands between simple spreadsheet models and sophisticated stochastic computer simulations. It describes a pandemic wave within a homogeneously mixing population like a town or city, but surprisingly produces the same dynamics as individual-based simulations which explicitly consider geographic spread through the US (cf. [6] and [5] with Figure 2 using R 0 = 2). Similar observations were made with a simple deterministic compartmental model [7] . Stochastic models are known to behave quasi-deterministically when the simulated population becomes very large.
A further reason for the congruence of complex stochastic and simple deterministic models must lie in the incredi-bly quick way in which pandemic influenza spreads geographically. Unless being controlled at the place of origin [12, 13] , a pandemic starting in a far-off country will lead to multiple introductions [14] into the large industrialized nations where it can be expected to quickly spread to neighbouring towns and to rural areas. The large populations which have to be considered susceptible to a pandemic virus and the quick geographic spread tend to diminish the differences between the results of sophisticated individual-based and simple deterministic models.
However, a deterministic model like InfluSim cannot reliably represent effects originating from stochasticity, from effects in small populations, or from heterogeneities. Examples are: (i) a geographically limited spread and fairly effective control measures can imply that the epidemic affects only a small population and thus, may be strongly influenced by stochastic events [15] [16] [17] ; (ii) transmission which predominantly occurs in households or hospitals, or which is driven by other substantial features of the contact network is not in agreement with the assumption of homogeneous mixing in the deterministic model cannot reliably predict the spread of infection [18] [19] [20] [21] [22] [23] . In particular, (iii) super-spreading events can substantially change the course of an epidemic compared to the deterministic prediction [24] [25] [26] [27] . Apart from such factors, the predictability of intervention success is generally subject to uncertainties in the choice of parameter values, Assumed scenarios and outcomes of pandemic preparedness plans. * Gross attack rate (i.e. clinically ill and moderately ill cases). A population of N = 100,000 inhabitants of Germany is subdivided according to age a and risk category r. We assume that all age groups are fully susceptible at begin of the outbreak. A fraction of F a = 6% of all children (age < 20 years) are regarded as being under high risk (r = r 1 ) after an influenza infection whereby the remaining 94% are under low risk (r = r 2 ). The high risk fractions of working adults (ages 20-59) and elderly (ages 60+) are F a = 14% and F a = 47%, respectively. Source: [9] demanding additional efforts like Bayesian approaches [28] to evaluate the reliability of predictions [29] .
Pandemic preparedness plans must consider constraints and capacities of locally operating public health systems. The time-dependent solutions of InfluSim allow assessing peak values of the relevant variables, such as outpatients, hospitalizations and deaths. Various interventions may be combined to find optimal ways to reduce the total number of cases, to lower the peak values or to delay the peak, hoping that at least part of the population may benefit from a newly developed vaccine.
Special care was taken when implementing a variety of pharmaceutical and non-pharmaceutical interventions which will be discussed in subsequent papers. Despite its comprehensible structure, the model does not suffer from over-simplifications common to usual compartment models. Instead of implicitly using exponentially distributed sojourn times, we have implemented realistically distributed delays. For example, the model considers that individuals may transmit infection before onset of symptoms, and that some cases may remain asymptomatic, but still infecting others. Such features have serious implications for the success of targeted control measures.
InfluSim is freely accessible, runs on a regular desktop computer and produces results within a second after changing parameter values. The user-friendly interface and the ease at which results can be generated make this program a useful public health planning tool. Although we have taken care of providing a bug-free program, including the source code, the user is encouraged to treat results with due caution, to test it, and to participate in bug-reports and discussions on the open-source platform [30] which also provides regular updates of InfluSim. 
The author(s) declare that they have no competing interests.
ME developed the model, MS designed the software, HPD wrote the manuscript and SOB formulated the public The who-acquires-infection-from-whom matrix shows the frequency of contacts (per week per person) between different age classes.
Source: [38] . Distribution of sojourn times (the last two stages of the latent period are used as early infectious period with an average duration of D L = 0.5 days). Sources: A [11] , B [39, 40] , C assumed, D [41] health requirements of the software. All authors read and approved the final manuscript.
Susceptible individuals S a, r are infected at a rate λ a (t) which depends on their age a and on time t. Infected individuals, E a, r , incubate the infection for a mean duration D E . To obtain a realistic distribution of this duration, the incubation period is modelled in n stages so that progression from one stage to the next one occurs at rate δ = n/D E .
The last l incubation stages are regarded as early infectious period during which patients may already spread the infection (this accounts for an average time of lD E /n for the "early infectious period" which is about half a day for the standard set of parameters). After passing through the last incubation stage, infected individuals become fully contagious and a fraction of them develops clinical symptoms. The course of disease depends on the age a of the infected individual and on the risk category r to which he or she belongs: a fraction c a, r (A) becomes asymptomatic (A a ), a fraction c a, r (M) becomes moderately sick (M a ), a fraction c a, r (V) becomes very sick (V a ) and the remaining fraction c a, r (X) becomes extremely sick (X a ) and need hospitalization (i.e., c a, r (A) + c a, r (M) + c a, r (V) + c a, r (X) = 1 for each combination of a and r). ) . A fraction f V (t) of all severe and a fraction f X (t) of all extremely severe cases who visit the doctor within D T days after onset of symptoms are offered antiviral treatment, given that its supply has not yet been exhausted. As our model does not explicitly consider the age of the disease (which would demand partial differential equations), we use the contagious stages to measure time since onset and allow for treatment up to stage m a, T Sources: Contagiousness of asymptomatic cases: [11] ; degree of contagiousness during the early infectious period and equality of the contagiousness of moderately and severely sick cases: assumed. Independent of age a and risk group r, a fraction c a, r (A) = 33% of infections result in asymptomatic cases, a fraction c a, r (M) = 33.5% become moderately sick and the remaining fraction develops severe disease. An age-and risk-dependent fraction h a, r of untreated patients with severe disease needs hospitalization. An age-dependent fraction d a of hospitalized cases dies. Sources: fraction of asymptomatic cases: [11] ; 50% of symptomatic cases see a doctor: [9] ; hospitalizations per severe case: [9] ; case fatality of hospitalized, but untreated patients calculated from [4] .
(see below for details). This imposes some variability to the maximum time until which treatment can be given, which may even improve the realism of the model with respect to real-life scenarios. Antiviral treatment reduces the patients' contagiousness by f I percent and it reduces hospitalization and death by f H percent. Extremely sick patients, whose hospitalization is prevented by treatment, are sent home and join the group of treated very sick patients(W a, T ). The remaining duration of disease and contagiousness of treated cases is reduced by f D percent so that their rate of progressing from one stage to the next has To obtain a realistic distribution of this sojourn time, convalescence is modelled in j stages so that progression from one stage to the next occurs at rate ρ = j/D C . Fully recovered patients who have passed through their last stage of convalescence join the group of healthy immunes I; working adults will go back to work. Further interventions, describing the reduction of contacts, will be discussed after the presentation of the differential equations.
InfluSim user interface Figure 1 InfluSim user interface. x 50 = 95% means that 95% of the cumulative contagiousness is concentrated during the first half of the contagious period, see Table 6 ). D: Cumulative number of deaths for values of x 50 as in C. All other parameters as listed in Tables 2-6 . Hospitalized, but untreated cases
Contact matrix For the mixing of the age classes, we employ a whoacquires-infection-from whom matrix which gives the relative frequency of contacts of infective individuals of age a i with other people of age a s . In this paper, we assume bi-directional contacts (e.g. children have the same total number of contacts with adults as adults with children). Multiplication of this matrix with an appropriate constant scaling factor κ (see below)
results in the matrix of crude contact rates .
In the absence of interventions, we have to multiply these contact rates with the contagiousness factors b L , b A , b M and b V to obtain the effective contact rates:
during the early infectious period, of asymptomatic cases, of moderately sick cases, of (untreated) very sick cases.
To assess the effect of day care centre and school closing on the transmission of an infectious disease, we have to first make an assumption on what fraction r sch of the contacts among healthy children who are in the same age class occurs in day care centres and schools. The contact rates between very sick or hospitalized children (who do not attend day care centre or school) and other children need, therefore, be reduced to (contact rate between healthy and very sick children in the same age class, i.e. a i = a s ).
As very sick children have to be taken care of by adults at home or in hospital, their contact rate to adults increases by a factor F HC (contact rate between very sick children of age a i and adults of age a s ).
Contacts between very sick children and other children in a higher or lower age class remain unchanged: (contact rate between healthy children of age a s and very sick children of a different age a i ).
Closing day care centres and schools at time t will not necessarily prevent all the contacts that would have happened with other children. During the closing of schools and day care centres, the contact rates between susceptible children of age a s and infected children of age a i who are in their late incubation period ( ), who are asymptomatic ( ), or who are moderately sick ( ) are reduced by the factor r sch if the children are in the same age class:
where 1 sch (t) is a function which indicates when schools and day care centres are opened or closed: 
,..., While day care centres and schools are closed, children (age a i ) need adult supervision at home. Their contact with susceptible adults (age a s ) increases by the "child care factor" F CC :
Child care at home also increases the exposure of healthy children (age a s ) to contagious adults (age a i ):
Cancelling mass gathering events effects only the contacts of adults who are healthy enough to attend such events. Assuming that such an intervention at time t reduces contacts by a fraction r mass , we get for all contacts between susceptible adults of age a s and infectious adults of age a i the following contact rates:
where 1 mass (t) is a function which indicates when mass gathering events are possible or when they are closed:
As contacts with adults who are too sick to attend such mass gathering events cannot be prevented by this measure it is .
During some time in the epidemic, the general population may effectively reduce contacts which can be a result of wearing facial masks, increasing "social distance", adopting improved measures of "respiratory hygiene" or simply of a general change in behaviour. This will be implemented in the program by reducing the contacts of susceptible individuals at that time t by factor r gen (t 
while mass gathering events are forbidden while m mass gathering events are allowed. while the population reduces their contacts while the population behaves as usual.
The contact rates of cases in the late incubation period and that of asymptomatic cases remain unchanged:
for infected individuals in the late incubation period, for asymptomatic cases.
To allow for a contagiousness which changes over the course of disease, we multiply each contact rate with a weighting factor whereby k is the stage of contagiousness. This leads to the following contact rates:
for asymptomatic cases in For x = 1, contagiousness is equally high in all stages; for x = 0, only the first stage is contagious; for 0 <x < 1, the contagiousness decreases in a geometric procession. We make the simplifying assumption that contagiousness does not change during the late incubation period for cases in stage k = n -l,..,n of the incubation period.
At time t = 0 and in the absence of interventions, the next generation matrix has the following elements where is the fraction of untreated extremely severe cases who die from the disease (see below for details). The dominant eigenvalue of this matrix is called the basic reproduction number R 0 . If κ (which determines the value of the contact rates ) is given, the eigenvectors of this matrix can numerically be calculated. The user-specified value of R 0 is now used to determine numerically the scaling factor κ. Let be the eigenvector which has the largest eigenvalue R 0 . 
) ) − 
Using the user-specified numbers of people N a in the age classes and the fractions F a of people under high risk within each age class (Table 2) , we obtain the initial population sizes according to age and risk class: Using these initial values, the set of differential equations is solved numerically with a Runge-Kutta method with step-size control. 
if and in treatment window otherwise 0 ⎩ ⎩